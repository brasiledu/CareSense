{% extends 'base.html' %}

{% block title %}Executar Testes - {{ assessment.patient.full_name }} - Avivamente{% endblock %}

{% block content %}

<style>
    .test-card {
        border-radius: 8px;
        padding: 1.5rem;
        text-align: center;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        background: #fff;
        transition: all 0.3s ease;
        border: 2px solid #f0f0f0;
    }
    .test-card.test-completed {
        border-color: #27ae60;
        background: #e8f5e8;
    }
    .test-card.test-pending {
        border-color: #ffeaa7;
        background: #fffbe6;
    }
    .test-card .badge {
        margin-bottom: 0.5rem;
        display: block;
    }
    .badge {
        display: inline-block;
        padding: 0.25rem 0.5rem;
        font-size: 0.85rem;
        font-weight: 600;
        border-radius: 4px;
        text-transform: uppercase;
        margin-bottom: 0.5rem;
    }
    .badge-pending {
        background: #ffeaa7;
        color: #2d3436;
    }
    .badge-completed {
        background: #00b894;
        color: #fff;
    }
    .btn {
        display: inline-block;
        padding: 0.75rem 1.5rem;
        background: #3498db;
        color: white;
        text-decoration: none;
        border-radius: 4px;
        border: none;
        cursor: pointer;
        font-size: 1rem;
        transition: background-color 0.3s;
        margin: 0.25rem;
    }
    .btn-success {
        background: #27ae60;
    }
    .btn-warning {
        background: #f39c12;
    }
    .btn:hover {
        background: #2980b9;
    }
    .btn-success:hover {
        background: #229954;
    }
    .btn-warning:hover {
        background: #e67e22;
    }
</style>

<div class="card">
    <h1><i class="fas fa-flask"></i> Bateria de Testes Neuropsicológicos</h1>
    <div style="background: #e8f4f8; padding: 1rem; border-radius: 4px; margin: 1rem 0;">
        <strong><i class="fas fa-user"></i> Paciente:</strong> {{ assessment.patient.full_name }} ({{ assessment.patient.age }} anos)<br>
        <strong><i class="fas fa-calendar"></i> Avaliação ID:</strong> {{ assessment.id }}<br>
        <strong><i class="fas fa-chart-bar"></i> Status:</strong> {{ assessment.get_status_display }}
    </div>
</div>

<div class="card">
    <h2><i class="fas fa-clipboard-list"></i> Progresso dos Testes</h2>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1.5rem; margin: 2rem 0;">
        <!-- Teste 1: Digit Span -->
        <div class="test-card test-{% if tests_completed.digit_span %}completed{% else %}pending{% endif %}">
            <h3><i class="fas fa-sort-numeric-up"></i> Span de Dígitos</h3>
            <p>Teste de memória de trabalho</p>
            {% if tests_completed.digit_span %}
                <span class="badge badge-completed"><i class="fas fa-check"></i> Concluído</span>
                <div style="margin-top: 1rem;">
                    <a href="{% url 'run_digit_span' assessment.id %}" class="btn" style="font-size: 0.9rem;"><i class="fas fa-redo"></i> Refazer</a>
                </div>
            {% else %}
                <span class="badge badge-pending"><i class="fas fa-clock"></i> Pendente</span>
                <div style="margin-top: 1rem;">
                    <a href="{% url 'run_digit_span' assessment.id %}" class="btn btn-success"><i class="fas fa-play"></i> Iniciar</a>
                </div>
            {% endif %}
        </div>
        
        <!-- Teste 2: TMT -->
        <div class="test-card test-{% if tests_completed.tmt %}completed{% else %}pending{% endif %}">
            <h3><i class="fas fa-target"></i> Trail Making Test</h3>
            <p>Teste de atenção e flexibilidade</p>
            {% if tests_completed.tmt %}
                <span class="badge badge-completed"> Concluído</span>
                <div style="margin-top: 1rem;">
                    <a href="{% url 'run_tmt' assessment.id %}" class="btn" style="font-size: 0.9rem;"><i class="fas fa-redo"></i> Refazer</a>
                </div>
            {% else %}
                <span class="badge badge-pending">⏳ Pendente</span>
                <div style="margin-top: 1rem;">
                    <a href="{% url 'run_tmt' assessment.id %}" class="btn btn-success">▶️ Iniciar</a>
                </div>
            {% endif %}
        </div>
        
        <!-- Teste 3: Stroop -->
        <div class="test-card test-{% if tests_completed.stroop %}completed{% else %}pending{% endif %}">
            <h3> Teste de Stroop</h3>
            <p>Teste de controle inibitório</p>
            {% if tests_completed.stroop %}
                <span class="badge badge-completed"> Concluído</span>
                <div style="margin-top: 1rem;">
                    <a href="{% url 'run_stroop' assessment.id %}" class="btn" style="font-size: 0.9rem;"><i class="fas fa-redo"></i> Refazer</a>
                </div>
            {% else %}
                <span class="badge badge-pending"> Pendente</span>
                <div style="margin-top: 1rem;">
                    <a href="{% url 'run_stroop' assessment.id %}" class="btn btn-success">▶️ Iniciar</a>
                </div>
            {% endif %}
        </div>
    </div>
</div>

{% if all_completed %}
<div class="card" style="background: #e8f5e8; border: 2px solid #27ae60;">
    <h2> Todos os Testes Concluídos!</h2>
    <p>Todos os testes neuropsicológicos foram realizados. Você pode agora finalizar a avaliação para gerar o relatório final.</p>
    
    <div style="margin: 2rem 0;">
        <a href="{% url 'complete_assessment' assessment.id %}" class="btn btn-success" style="font-size: 1.1rem; padding: 1rem 2rem;">
             Finalizar Avaliação e Gerar Relatório
        </a>
    </div>
</div>
{% endif %}

<div class="card">
    <h2> Instruções</h2>
    <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 4px;">
        <h4>Como aplicar os testes:</h4>
        <ol style="margin-left: 2rem; line-height: 1.8;">
            <li><strong>Span de Dígitos:</strong> Teste a capacidade de repetir sequências de números na ordem direta e inversa</li>
            <li><strong>Trail Making Test:</strong> Meça o tempo para conectar números (Parte A) e alternar entre números e letras (Parte B)</li>
            <li><strong>Teste de Stroop:</strong> Avalie o controle inibitório através da nomeação de cores com interferência</li>
        </ol>
        
        <p style="margin-top: 1rem; color: #e67e22; font-weight: bold;">
             Execute os testes na ordem sugerida para melhores resultados.
        </p>
    </div>
</div -->

<div class="card">
    <h2> Ações</h2>
    <a href="/assessments/{{ assessment.id }}/" class="btn"><i class="fas fa-eye"></i> Ver Detalhes da Avaliação</a>
    <a href="/patients/{{ assessment.patient.id }}/" class="btn"><i class="fas fa-user"></i> Ver Dados do Paciente</a>
    <a href="/dashboard/" class="btn btn-warning"><i class="fas fa-home"></i> Voltar ao Dashboard</a>
</div>
{% endblock %}
